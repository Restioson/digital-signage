{% extends "base.j2" %}

{% block title %}Register a new user{% endblock %}
{% block head %}
  {{ super() }}
  {{ css('config/users') }}
{% endblock %}

{% block content %}
  <script type="module">
    import {
      setupPostForms,
      populateUsersAndDepartments,
    } from "{{ url_for('static', filename='config.mjs') }}";
    setupPostForms(function (res) {
      if (res.id === "response needed") {
        return `Response: ${res.response}`;
      } else {
        return `Successfully submitted (id: ${res.id})`;
      }
    });
    populateUsersAndDepartments();
  </script>


  <h2>User List</h2>
  <table id="user-list">
    <thead>
      <tr>
        <th>Email</th>
        <th>Username</th>
        <th>Department ID</th>
        <th>Permissions</th>
        <th>Delete User</th>
      </tr>
    </thead>
    <tbody>
      <!-- User data will be populated here -->
    </tbody>
  </table>

  {# <!-- [html-validate-disable-next attribute-allowed-values] --> doesn't understand J2 syntax #}
  <form
    action="/api/register"
    method="post"
    classname="register"
    class="post-form"
    enctype="multipart/form-data"
  >
    <label
      >Email Address:
      <input type="email" id="email" name="email" required />
    </label>

    <label
      >Username:
      <input type="text" id="screen_name" name="screen_name" required />
    </label>

    <label
      >Password:
      <input
        type="password"
        id="password"
        name="password"
        pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{12,}"
        title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters"
        required
      />
    </label>

    <label for="department"
      >Department:
      <select id="department" name="department">
        <!-- Options will be dynamically populated here -->
      </select>
    </label>

    <label for="permissions"
      >Select permission:
      <select id="permissions" name="permissions">
        <option value="superuser">Superuser</option>
        <option value="edituser">Edituser</option>
        <option value="postinguser">Postinguser</option>
      </select>
    </label>
    <button type="submit" name="register">Create account</button>
  </form>

  <form
    action="/api/department/create"
    method="post"
    class="post-form"
    enctype="multipart/form-data"
    classname="create_department"
  >
    <label
      >Department name:
      <input type="name" id="name" name="name" required />
    </label>
    <button type="submit">Create department</button>
    <p hidden id="status-message"></p>
  </form>
{% endblock %}
